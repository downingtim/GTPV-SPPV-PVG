# Pangenome variation graph (PVG) analysis of sheeppox (SPPV) and goatpox (GTPV) viruses üß¨

This repository contains the R and Shell scripts used for a pangenome variation graph (PVG) analysis of Sheeppox Virus (SPPV) and Goatpox Virus (GTPV), focusing on analyses of genomic diversity.

## Repository Structure

The repository is organised into two main directories:

-   `üìÅ FIGURES/`: Contains all the output plots and figures generated by the analysis scripts in PDF and PNG format.
-   `üìÅ scripts/`: Contains the analysis scripts used to process data and generate the figures.

***

## Scripts üî¨

This section details the purpose, dependencies, required inputs, and outputs for each script in the `scripts/` directory.

### **`01_phylogeny_PCA.GTPV.R`** and **`01_phylogeny_PCA.SPPV.R`**

These scripts perform phylogenetic analysis and Principal Component Analysis (PCA) for Goatpox (GTPV) and Sheeppox (SPPV) viruses, respectively.

* **Purpose**:
    1.  **Phylogenetic Tree**: Reads a RAxML-generated tree file with bootstrap support, midpoint roots it, and visualises it. It annotates the tree with bootstrap values (‚â•90%) and colours tips based on predefined genetic groups.
    2.  **PCA**: Reads a multiple sequence alignment, converts it to a numeric matrix, and performs PCA to visualise the genetic clustering of the viral isolates.
    3.  **Combined Plot**: Merges the phylogenetic tree and the PCA plot into a single comparative figure.
* **Dependencies (R Packages)**: `ape`, `phangorn`, `ggplot2`, `ggtree`, `treeio`, `dplyr`, `RColorBrewer`, `seqinr`, `ggrepel`, `gridExtra`.
* **Input Files**:
    * `T14.raxml.supportTBE`: A Newick tree file with bootstrap support values.
    * `genomes.aln`: A FASTA-formatted multiple sequence alignment of the viral genomes.
* **Output Files**:
    * `goatpox_phylogeny.pdf`/`.png` or `sheeppox_phylogeny.pdf`/`.png`
    * `goatpox_pca.pdf` or `sheeppox_pca.pdf`
    * `sheeppox_pca.PC3.PC4.pdf` (for SPPV only)
    * `goatpox_combined_analysis.pdf`/`.png` or `sheeppox_combined_analysis.pdf`/`.png`

### **`02_count_vcf.sh`**

*Note: This is a Bash script and should be run in a Unix-like terminal.*

* **Purpose**: Counts the occurrences of different variant types (SNP, DEL, INS, MNP, COMPLEX, COMPOUND) within the first and last 5 Kb of a given Variant Call Format (VCF) file.
* **Dependencies**: Standard Unix command-line tools (`bash`, `grep`, `wc`, `head`, `tail`, `awk`).
* **Input File**:
    * A VCF file (e.g., `gfavariants.vcf`).
* **Usage**:
    ```bash
    bash 02_count_vcf.sh gfavariants.vcf
    ```
* **Output**: The script prints the summary counts directly to the terminal. It does not generate any files.

### **`03_SNP_density.R`**

* **Purpose**: Generates a comprehensive visualisation of SNP density across the entire genomes of SPPV and GTPV. It plots SNV density in sliding windows and aligns this with a map of the Coding Sequences (CDS) from corresponding GenBank files, highlighting specific regions of interest.
* **Dependencies (R Packages)**: `ggplot2`, `dplyr`, `readr`, `genbankr`, `patchwork`.
* **Input Files**:
    * `results_SPPV/vcf/gfavariants.vcf`: VCF file for SPPV.
    * `results_GTPV/vcf/gfavariants.vcf`: VCF file for GTPV.
    * `nc_004002.gb`: GenBank file for the SPPV reference genome.
    * `nc_004003.gb`: GenBank file for the GTPV reference genome.
* **Output Files**:
    * `snv_density_with_cds.pdf`/`.png`: A combined plot showing SNP density and CDS maps for both viruses.

### **`03_SNP_density.ITR.R`**

* **Purpose**: This is a version of the SNP density script that creates a focused comparison of SNV density within the terminal regions (first and last 5 Kb) of the SPPV and GTPV genomes, which include the Inverted Terminal Repeats (ITRs).
* **Dependencies (R Packages)**: `ggplot2`, `dplyr`, `readr`, `genbankr`, `patchwork`.
* **Input Files**:
    * `results_SPPV/vcf/gfavariants.vcf`: VCF file for SPPV.
    * `results_GTPV/vcf/gfavariants.vcf`: VCF file for GTPV.
    * `nc_004002.gb`: GenBank file for the SPPV reference genome.
    * `nc_004003.gb`: GenBank file for the GTPV reference genome.
* **Output Files**:
    * `snv_density_terminal_regions.pdf`: A side-by-side plot comparing SNV density in the initial and terminal 5 Kb regions of the genomes.

***

## Figures üìà

The `FIGURES/` directory contains all outputs. Key figures include:

#### **Phylogeny and PCA**

* `goatpox_combined_analysis.pdf` / `sheeppox_combined_analysis.pdf`: Combined phylogenetic tree and PCA plot.
* `sheeppox_pca.PC3.PC4.pdf`: PCA plot using the 3rd and 4th principal components for SPPV.

#### **SNP Density Analysis**

* `snv_density_with_cds.pdf`: Genome-wide SNV density plotted against gene locations for SPPV and GTPV.
* `snv_density_terminal_regions.pdf`: Focused view of SNV density in the terminal regions of the genomes.

#### **PVP analysis (other figures)**

The directory also contains several other figures related to pan-genomic analyses, such as:

* Pangenome graph growth curves (`goatpox_pangrowth.pdf`, `sheeppox_pangrowth.pdf`)
* Core gene estimates (`goatpox_p_core.pdf`, `sheeppox_p_core.pdf`)
* Gene presence/absence visualisations (`goatpox_out.viz.png`, `sheeppox_out.viz.png`)

***

## Getting Started

### Prerequisites

1.  **R**: Ensure you have R installed on your system.
2.  **R Packages**: You will need several R packages. You can install them all by running the following command in an R console:
    ```R
    install.packages(c("ape", "phangorn", "ggplot2", "ggtree", "treeio", "dplyr", "RColorBrewer", "seqinr", "ggrepel", "gridExtra", "readr", "genbankr", "patchwork"))
    ```
3.  **Bash**: For running the `.sh` script, a Unix-like terminal (Linux, macOS, or WSL on Windows) is required.

### Running the Scripts

1.  **Clone the repository**:
    ```bash
    git clone https://github.com/downingtim/GTPV-SPPV-PVG
    cd GTPV-SPPV-PVG
    ```
2.  **Prepare Input Data**: Make sure all required input files (`.vcf`, `.aln`, `.gb`, `.supportTBE`) are present in the correct paths as specified in the scripts. You may need to create directories like `results_SPPV/vcf/`.

3.  **Execute a script**: Run any of the R scripts from the terminal using the `Rscript` command.
    ```bash
    # Example for running the SPPV phylogeny/PCA script
    Rscript scripts/01_phylogeny_PCA.SPPV.R
    ```
